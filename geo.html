<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Print out long/lat data</title>
<script language="javascript" type="text/javascript" src="js/jquery-1.5.2.js"></script>
<script language="javascript" type="text/javascript" src="js/exports.js"></script>
<script language="javascript" type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
</head>
<body>

<script type="text/javascript">
$(document).ready(function() {
    var geocoder = new google.maps.Geocoder(),
        data = {};
    
    var outputLocations = function(output, errors, countries) {
        setInterval(function() {
            var next = countries.pop();
            var geocoder = new google.maps.Geocoder();

            geocoder.geocode({ address: next }, function(geo) {
                var lnglat;

                if (geo && geo.length == 1 && geo[0].geometry && geo[0].geometry.location) {
                    lnglat = geo[0].geometry.location;
                    output.append(next + "," + lnglat.lat() + "," + lnglat.lng() + "<br/>");
                } else {
                    errors.append(next + "<br/>");
                }

            });
            
            // perform a search on that country
        }, 1000);
    };
    
    $exports.countryData("New Zealand", function(data) {
        var countries = [];
        
        // make an array of countries
        $.each(data.geo, function(country, d) {
            countries.push(country);
        });
        
        outputLocations($('#output'), $('#errors'), countries);
    });
});

</script>
<div id="output"><strong>Data:</strong><br/></div>
<p>
<div id="errors"><strong>Errors:</strong><br/></div>

</body>
</html>
